<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="DUToolkit">
<title>Probability density plots with risk shading â€¢ DUToolkit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Probability density plots with risk shading">
<meta property="og:description" content="DUToolkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">DUToolkit</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/DUToolkit.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Calculating_Risk.html">Calculating Risk</a>
    <a class="dropdown-item" href="../articles/Fan_Plots.html">Time-outcome fan plots</a>
    <a class="dropdown-item" href="../articles/density_plots.html">Probability density plots with risk shading</a>
    <a class="dropdown-item" href="../articles/rain_plot.html">Raincloud plots</a>
    <a class="dropdown-item" href="../articles/temporal_plot.html">Temporal probability density plots</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Probability density plots with risk shading</h1>
            
      
      
      <div class="d-none name"><code>density_plots.Rmd</code></div>
    </div>

    
    
<p>Another important factor for decision-makers is assessing the
severity of the situation at its expected peak (or minimum). To do this,
we plot the probability density of the highest (or lowest if the
threshold is a minimum) projected outcome across simulation runs for a
given policy alternative. The decision threshold is shown directly on
the plot as a vertical line. The area under the probability density
curve where the threshold value is exceeded is shaded to visually
display the downside risk of the policy alternative.</p>
<p>In our example, we define the peak as the highest hospital demand
observed in each simulation run. First, we find these values using the
<code><a href="../reference/get_max_min_values.html">get_max_min_values()</a></code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define inputs</span></span>
<span><span class="va">tmin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">psa_data</span><span class="op">$</span><span class="va">Intervention_1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># minimum simulation time</span></span>
<span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">psa_data</span><span class="op">$</span><span class="va">Intervention_1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># maximum simulation time</span></span>
<span><span class="va">Dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">750</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tmin</span><span class="op">:</span><span class="va">tmax</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># decision threshold vector </span></span>
<span><span class="va">Dt_max</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># indicates the threshold values are maximums</span></span>
<span></span>
<span><span class="co">## find peak values</span></span>
<span><span class="va">peak_values_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_max_min_values.html">get_max_min_values</a></span><span class="op">(</span><span class="va">psa_data</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">Dt_max</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">peak_values_list</span><span class="op">$</span><span class="va">Baseline</span><span class="op">)</span></span>
<span><span class="co">#&gt;   N  outcome     i_time</span></span>
<span><span class="co">#&gt; 1 1 4207.443 2021-01-26</span></span>
<span><span class="co">#&gt; 2 2 1681.521 2021-02-01</span></span>
<span><span class="co">#&gt; 3 3 2539.177 2021-02-04</span></span>
<span><span class="co">#&gt; 4 4 2969.721 2021-01-31</span></span>
<span><span class="co">#&gt; 5 5 3073.741 2021-02-05</span></span>
<span><span class="co">#&gt; 6 6 1520.144 2021-02-08</span></span></code></pre></div>
<p>We then use the <code><a href="../reference/plot_density.html">plot_density()</a></code> function to generate the
probability density plots.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define single threshold value for the peak</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fl">750</span></span>
<span></span>
<span><span class="co"># calculate risk measure</span></span>
<span><span class="va">risk_measures_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_risk.html">calculate_risk</a></span><span class="op">(</span><span class="va">psa_data</span>, <span class="va">tmin</span>, <span class="va">tmax</span>, <span class="va">Dt</span>, <span class="va">Dt_max</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate density plots</span></span>
<span><span class="va">density_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_density.html">plot_density</a></span><span class="op">(</span></span>
<span>  <span class="va">peak_values_list</span>, <span class="va">D</span>,</span>
<span>  <span class="va">Dt_max</span>, <span class="va">risk_measures_list</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## example plot</span></span>
<span><span class="va">density_plots</span><span class="op">$</span><span class="va">Intervention_1</span></span></code></pre></div>
<p><img src="density_plots_files/figure-html/gen_den-1.png" width="100%"></p>
<p>All plotting functions in the DUToolkit return ggplot2 plot objects.
You can adjust/customize the plots after they have been generated (<a href="https://rstudio.github.io/cheatsheets/html/data-visualization.html" class="external-link">ggplot2
cheat sheet</a>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># customize plots</span></span>
<span><span class="co">## add fixed x/y-axis limits and change the label of the x-axis</span></span>
<span><span class="va">density_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">density_plots</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.002</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4500</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Hospital demand at peak"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## remove subtitle and caption</span></span>
<span><span class="va">density_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">density_plots</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="cn">NULL</span>, caption <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## example plot</span></span>
<span><span class="va">density_plots</span><span class="op">$</span><span class="va">Intervention_1</span></span></code></pre></div>
<p><img src="density_plots_files/figure-html/cust_den-1.png" width="100%"></p>
<p>The <code><a href="../reference/calculate_max_min_risk.html">calculate_max_min_risk()</a></code> function is used within
<code><a href="../reference/plot_density.html">plot_density()</a></code> to calculate the risk measures at the peak
values (or lowest values if the threshold is a minimum), which is then
displayed in the plot subtitle. Additionally,
<code><a href="../reference/calculate_max_min_risk.html">calculate_max_min_risk()</a></code> can be used independently to
generate results without creating density plots.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate risk measures at peak values</span></span>
<span><span class="va">peak_risk</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_max_min_risk.html">calculate_max_min_risk</a></span><span class="op">(</span><span class="va">peak_values_list</span>, <span class="va">D</span>, <span class="va">Dt_max</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate risk table dataframe</span></span>
<span><span class="va">peak_risk_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabulate_risk.html">tabulate_risk</a></span><span class="op">(</span><span class="va">peak_risk</span>, n_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">peak_risk</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peak_risk_table</span></span>
<span><span class="co">#&gt;                    Baseline  Intervention 1</span></span>
<span><span class="co">#&gt; Risk               "1500.79" "156.52"      </span></span>
<span><span class="co">#&gt; Policy risk impact "-"       "-89.57%"</span></span></code></pre></div>
<p>The <code><a href="../reference/calculate_threshold_probs.html">calculate_threshold_probs()</a></code> function calculates the
probability that the peak (or minimum) value exceeds (or is below) a
specified threshold(s) using a Riemann sum approach.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define vector of threshold values</span></span>
<span><span class="va">Dp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">750</span>, <span class="fl">1000</span>, <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate probability that peak value is &gt; specified threshold values</span></span>
<span><span class="va">peak_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_threshold_probs.html">calculate_threshold_probs</a></span><span class="op">(</span><span class="va">peak_values_list</span>, <span class="va">Dp</span>, <span class="va">Dt_max</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peak_probs</span><span class="op">$</span><span class="va">Baseline</span></span>
<span><span class="co">#&gt;    750   1000   2000 </span></span>
<span><span class="co">#&gt; 0.9494 0.8887 0.5895</span></span></code></pre></div>
<div class="section level3">
<h3 id="den-outputs">Sharing outputs<a class="anchor" aria-label="anchor" href="#den-outputs"></a>
</h3>
<p>The proability density plots further supplement the risk table and
the time-outcome fan plots by quantifying and visually displaying how
likely it is that the outcome at its projected peak will exceed the
threshold, capturing the downside risk associated with the projected
peak outcome.</p>
<p>We also recommend the following standard description for presenting
the probability density plots to decision-makers. We provide the
standard description in paragraph and bullet point form for ease of
use.</p>
<div class="section level4 unnumbered">
<h4 class="unnumbered" id="standard-description">Standard description<a class="anchor" aria-label="anchor" href="#standard-description"></a>
</h4>
<div class="rmdnote">
<p>These probability density graphs show the distribution of the
<u><em>highest</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;lowest&lt;/em&gt;&lt;/p&gt;"><sup>1</sup></a> forecasted <u><em>outcome</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;insert outcome description (ex. hospital demand)&lt;/p&gt;"><sup>2</sup></a> (i.e., the
<u><em>peak</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;low
point&lt;/em&gt;&lt;/p&gt;"><sup>3</sup></a>). The red dashed line indicates the policy
target. The shaded area indicates how likely it is that the
<u><em>outcome</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;insert outcome description (ex. hospital demand)&lt;/p&gt;"><sup>4</sup></a> at its forecasted <u><em>peak</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;low
point&lt;/em&gt;&lt;/p&gt;"><sup>5</sup></a> will
<u><em>exceed</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;fall
below&lt;/em&gt;&lt;/p&gt;"><sup>6</sup></a> the policy target, or simply, the amount of
downside risk. A larger shaded area means more downside risk.</p>
</div>
</div>
<div class="section level4 unnumbered">
<h4 class="unnumbered" id="standard-description-bullet-points">Standard description bullet points<a class="anchor" aria-label="anchor" href="#standard-description-bullet-points"></a>
</h4>
<div class="rmdnote">
<p>These probability density graphs show:</p>
<ul>
<li><p>The distribution of the <u><em>highest</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;lowest&lt;/em&gt;&lt;/p&gt;"><sup>7</sup></a> forecasted
<u><em>outcome</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;insert outcome description (ex. hospital demand)&lt;/p&gt;"><sup>8</sup></a> (i.e., the <u><em>peak</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;low
point&lt;/em&gt;&lt;/p&gt;"><sup>9</sup></a>).</p></li>
<li><p>The red dashed line indicates the policy target.</p></li>
<li><p>The shaded area indicates how likely it is that the
<u><em>outcome</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;insert outcome description (ex. hospital demand)&lt;/p&gt;"><sup>10</sup></a> at its forecasted <u><em>peak</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;low
point&lt;/em&gt;&lt;/p&gt;"><sup>11</sup></a> will
<u><em>exceed</em></u><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;if threshold is a minimum replace with &lt;em&gt;fall
below&lt;/em&gt;&lt;/p&gt;"><sup>12</sup></a> the policy target (i.e, the amount of
downside risk).</p></li>
<li><p>A larger shaded area means more downside risk.</p></li>
</ul>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Megan Wiggins, Marie Betsy Varughese, Ellen Rafferty, Sasha van Katwyk, Christopher McCabe, Jeff Round, Erin Kirwin, Institute of Health Economics, Canadian Network for Modelling Infectious Diseases .</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
